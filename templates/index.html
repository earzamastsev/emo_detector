<!DOCTYPE html>
<html lang="en">

<head>
    <title>Emotion detector</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" rel="stylesheet">
    <link href="/static/style.css" rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js" type="text/javascript"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.bundle.min.js"></script>
</head>

<body>
<div class="modal fade" id="myModal">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">

            <div class="modal-header">
                <h4 class="modal-title">Warning</h4>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>

            <div class="modal-body">
                You already have been started watch video. Please, choose reset previous statistics or continue
                watching?
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-danger reset-stats" data-dismiss="modal">Reset</button>
                <button type="button" class="btn btn-success continue-stats" data-dismiss="modal">Continue</button>
            </div>
        </div>
    </div>
</div>


<div class="spinner-border text-primary" id="spinner" role="status"
     style="display: none; z-index: 9999; position: fixed; left: 50%; top: 50%;">
    <span class="sr-only">Loading...</span>
</div>


<div aria-live="polite" aria-atomic="true" style="position: absolute; z-index: 99999;">
    <div class="toast" style="position: fixed; top: 0; right: 0;" data-autohide="false">
        <div class="toast-header">
            <button type="button" class="ml-2 mb-1 close" data-dismiss="toast" aria-label="Close" onClick="show()">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
        <div class="toast-body p-0" style="max-width: 100%;">
            <div class="card">
                <div class="card-body text-center p-0">
                    <canvas id="picture" width="320" height="240"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="container-fluid fullscreen" style="visibility: hidden; z-index: 9999;">
<div class="row w-100 h-100 m-4">
    <div class="card" style="width: 100%; height: 90%;">
        <h5 class="card-header h5 text-center">
            Test video
        </h5>
        <div class="card-body text-center">
<!--            <iframe src="https://www.youtube.com/embed/fn3KWM1kuAw"-->
<!--                    title="YouTube video player" frameborder="0"></iframe>-->
            <div class="m-2 card-body text-center">
                <button type="button" class="btn btn-success close-fullscreen">Close Fullscreen</button>
            </div>
        </div>
    </div>
</div>
</div>

<div class="container base">
    <div class="row m-4">
        <div class="col-lg-6">
            <div class="card">
                <h5 class="card-header h5 text-center">
                    Test video
                </h5>
                <div class="card-body text-center">
                    <iframe width="400" height="315" src="https://www.youtube.com/embed/fn3KWM1kuAw"
                    title="YouTube video player" frameborder="0"></iframe>
                    <div class="text-center">
                        <button type="button" class="btn btn-success open-fullscreen">Open Fullscreen</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-lg-6">
            <div class="card">
                <h5 class="card-header h5 text-center">
                    Live webcam
                </h5>
                <div class="card-body text-center">
                    <video id="video" width="400" height="315" autoplay>
                    </video>

                    <div class="text-center">
<!--                         <button type="button" class="btn btn-danger" onClick="stop()">-->
<!--                            Stop Cam-->
<!--                         </button>-->
                         <button type="button" class="btn btn-success start">
                            Start Cam
                         </button>
                         <button type="button" class="btn btn-info disabled btn-toast-show" onClick="show()">
                            Show emotion
                         </button>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <div class="row text-center m-3">
        <div class="col-lg-12 text-center">
            <a href="/plot/" class="btn btn-success get-graph">
                Load analytic data
            </a>
        </div>
    </div>

    <div class="row">
        <div class="col-lg-12">
            <div class="card">
                <h5 class="card-header h5 text-center graph-bar">
                    Emotion analytics
                </h5>
                <div class="card-body">
                    <div class="booth show-graph">
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>


<script>
    {% if not first_time %}
    	$("#myModal").modal();
    	const resetStatsElem = document.querySelector(".reset-stats");
        const continueStatsElem = document.querySelector(".continue-stats");
        resetStatsElem.addEventListener("click", (e) => {
            console.log('Reset');
            fetch("/check/", {
                "method": "POST",
                "headers": {
                        'Content-Type': 'application/json;charset=utf-8'
                        },
                "body": JSON.stringify({reset:"yes"})
                })
                .then(response => response.json())
                .then(result => {console.log(result)});
                });
        continueStatsElem.addEventListener("click", (e) => {
            console.log('Continue')
            fetch("/check/", {
                    "method": "POST",
                    "headers": {
                            'Content-Type': 'application/json;charset=utf-8'
                            },
                    "body": JSON.stringify({reset:"no"})
                    })
                    .then(response => response.json())
                    .then(result => {console.log(result)});
                    });
    {% endif %}

</script>

<script src="/static/camera.js"></script>

</body>
</html>
